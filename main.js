(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-35",headers:{authorization:"d45e7742-926e-4eb9-83ed-297f16544725","Content-Type":"application/json"}},t=function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось удалить пост. Ошибка: ".concat(e.status))}))},n=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось поставить лайк. Ошибка: ".concat(e.status))}))},r=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось удалить лайк. Ошибка: ".concat(e.status))}))};function o(e,n){var r=Array.from(document.querySelectorAll(".".concat(n.cardClass))).find((function(t){return t._id===e}));return null!=r?t(e).then((function(){return r.remove()})):Promise.reject("Этого поста не существует")}function c(e,t,o,c){!1===t.isLiked?n(t._id).then((function(n){t.isLiked=!0,e.classList.add(c.likeClass),o.textContent=n.likes.length})).catch((function(e){return c.handleError(e)})):r(t._id).then((function(n){t.isLiked=!1,e.classList.remove(c.likeClass),o.textContent=n.likes.length})).catch((function(e){return c.handleError(e)}))}var u=new CustomEvent("opened"),i=new CustomEvent("closed"),a=function(e,t,n,r){var o=e.querySelector(".".concat(t.id).concat(r.errorClassPostfix));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClassVisible)},s=function(e,t,n){var r=e.querySelector(".".concat(t.id).concat(n.errorClassPostfix));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClassVisible),r.textContent=""};function l(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}function d(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!1}function p(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?l(t,n):d(t,n)}function f(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var _={},y=document.querySelector(".places__list"),v=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),S=document.querySelector(".profile__image"),b=document.querySelectorAll(".popup"),C=document.querySelector(".popup_type_edit"),E=C.querySelector(".popup__form"),q=E.querySelector(".popup__input_type_name"),g=E.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),L=k.querySelector(".popup__form"),j=L.querySelector(".popup__input_type_card-name"),A=L.querySelector(".popup__input_type_url"),x=document.querySelector(".popup_type_image"),P=x.querySelector(".popup__image"),w=x.querySelector(".popup__caption"),T=document.querySelector(".popup_type_profile-image"),B=T.querySelector(".popup__form"),U=B.querySelector(".popup__input_type_url"),M=document.querySelector(".popup_type_confirm"),I=M.querySelector(".popup__title"),O=M.querySelector(".popup__form"),D=O.querySelector(".popup__button"),V=null,N=document.querySelector(".popup_type_error"),F=N.querySelector(".popup__type_error_text"),H=document.querySelector(".profile__edit-button"),J=document.querySelector(".profile__add-button"),G={templateSelector:"#card-template",cardClass:"card",titleClass:"card__title",imageClass:"card__image",deleteButtonClass:"card__delete-button",likeButtonClass:"card__like-button",likeClass:"card__like-button_is-active",likeCounterClass:"card__like-button_counter",removeMessage:"Удалить пост?",profile:_,confirmAction:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];V=function(t){return le.apply(void 0,[t,e].concat(r))},I.textContent=t,O.addEventListener("submit",V),l(D,W),Z(M)},handleError:de},z={visibleState:"popup_is-opened",invisibleState:"popup_is-animated"},W={formSelector:"popup__form",inputSelector:"popup__input",imageInputSelector:"popup__input_image-url",submitButtonSelector:"popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClassPostfix:"-error",errorClassVisible:"popup__error_visible"},$=new Map([[ue,"save"],[ie,"save"],[ae,"save"],[o,"delete"]]),K=function(e,t,n){for(var r=arguments.length,o=new Array(r>3?r-3:0),c=3;c<r;c++)o[c-3]=arguments[c];return function(r){var c=document.querySelector(".".concat(t));r.key===e&&null!=c&&n.apply(void 0,[c].concat(o))}}("Escape","popup_is-opened",ee),Q=function(){return F.textContent=""},R=function(){O.removeEventListener("submit",V),V=null,I.textContent=""},X=function(e){var t="Требуется ссылка на изображение";return fetch(e,{method:"HEAD"}).then((function(e){var n=e.headers.get("Content-Type");if(!(e.ok&&n&&n.startsWith("image/")))return Promise.reject(t)})).catch((function(e){return e===t?Promise.reject(e):Promise.reject("Не удалось проверить ссылку. Возможно, это не изображение")}))};function Y(e){return function(e,t,n,r,o){var c=document.querySelector(o.templateSelector).content.querySelector(".".concat(o.cardClass)).cloneNode(!0),u=c.querySelector(".".concat(o.titleClass)),i=c.querySelector(".".concat(o.imageClass)),a=c.querySelector(".".concat(o.deleteButtonClass)),s=c.querySelector(".".concat(o.likeButtonClass)),l=c.querySelector(".".concat(o.likeCounterClass)),d=e.likes.some((function(e){return e._id===o.profile._id}));return c._id=e._id,u.textContent=e.name,i.src=e.link,i.alt=e.name,l.textContent=e.likes.length,e.owner._id!=o.profile._id?a.remove():a.addEventListener("click",(function(){return o.confirmAction(t,o.removeMessage,c._id,o)})),d?(c.isLiked=!0,s.classList.add(o.likeClass)):c.isLiked=!1,s.addEventListener("click",(function(e){return n(e.target,c,l,o)})),i.addEventListener("click",(function(e){return r(e.target)})),c}(e,o,c,ce,G)}function Z(e){return function(e,t){e.classList.add(t.invisibleState),requestAnimationFrame((function(){return e.classList.add(t.visibleState)})),e.dispatchEvent(u)}(e,z)}function ee(e){return function(t,n,r){t.classList.remove(r.visibleState),setTimeout((function(){return t.classList.remove(r.invisibleState)}),fe(e)),t.dispatchEvent(i)}(e,0,z)}function te(e){Object.assign(_,e)}function ne(){v.textContent=_.name,h.textContent=_.about}function re(){S.style.backgroundImage="url(".concat(_.avatar,")")}function oe(e,t){null!=t&&(e.value=t)}function ce(e){P.src=e.src,P.alt=e.alt,w.textContent=e.alt,Z(x)}function ue(t,n){var r,o={};return o.name=t,o.about=n,(r=o,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r.name,about:r.about})}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось обновить данные пользователя. Ошибка: ".concat(e.status))}))).then((function(e){te(e),ne()}))}function ie(t){return(n=t,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось обновить аватар. Ошибка: ".concat(e.status))}))).then((function(e){te(e),re()}));var n}function ae(t,n){var r,o={};return o.name=t,o.link=n,(r=o,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r.name,link:r.link})}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось добавить пост. Ошибка: ".concat(e.status))}))).then((function(e){return y.prepend(Y(e))}))}function se(e){var t=e.querySelector(".popup__submit-message");t.classList.remove("popup__error_visible"),t.textContent=""}function le(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var c=e.target,u=c.closest(".popup"),i=c.querySelector(".popup__button"),s=i.textContent,l=$.get(t);switch(se(c),l){case"save":i.textContent="Сохранение...";break;case"delete":i.textContent="Удаление...";break;default:i.textContent="Подождите..."}(function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.imageInputSelector))),r=e.querySelector(".".concat(t.submitButtonSelector));if(n.length>0){var o=n.map((function(n){return X(n.value).catch((function(r){return a(e,n,r,t),Promise.reject()}))}));return Promise.allSettled(o).then((function(e){if(e.some((function(e){return"rejected"===e.status})))return d(r,t),Promise.reject("Введены недопустимые данные")}))}return Promise.resolve()})(c,W).then((function(){return t.apply(void 0,r)})).then((function(){return ee(u)})).catch((function(e){return function(e,t){var n=e.querySelector(".popup__submit-message");n.textContent=t,n.classList.add("popup__error_visible")}(c,e)})).finally((function(){return i.textContent=s}))}function de(e){F.textContent=e,Z(N)}function pe(e,t){setTimeout((function(){return t()}),fe(e))}function fe(e){var t,n=window.getComputedStyle(e).transitionDuration.split(", ").map((function(e){return e.includes("ms")?parseFloat(e):1e3*parseFloat(e)}));return Math.max.apply(Math,function(e){if(Array.isArray(e))return m(e)}(t=n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось получить данные пользователя. Ошибка: ".concat(e.status))})),fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Не удалось загрузить посты. Ошибка: ".concat(e.status))}))]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,u,i=[],a=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(s)throw o}}return i}}(t,n)||f(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];te(o),ne(),re(),c.forEach((function(e){return y.append(Y(e))}))})).catch((function(e){return de(e)})),function(e){Array.from(document.querySelectorAll(".".concat(e.formSelector))).forEach((function(t){t.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.inputSelector))),r=e.querySelector(".".concat(t.submitButtonSelector));p(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?s(e,t,n):a(e,t,t.validationMessage,n)}(e,o,t),p(n,r,t)}))}))}(t,e)}))}(W),H.addEventListener("click",(function(){return Z(C)})),J.addEventListener("click",(function(){return Z(k)})),S.addEventListener("click",(function(){return Z(T)})),b.forEach((function(e){return e.addEventListener("click",(function(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))&&ee(e)}))})),b.forEach((function(e){return e.addEventListener("opened",(function(){document.addEventListener("keydown",K)}))})),b.forEach((function(e){return e.addEventListener("closed",(function(e){var t;document.removeEventListener("keydown",K),null!=(t=e.target.querySelector(".popup__form"))&&t.reset(),function(e){var t=e.querySelector(".popup__form");null!=t&&(function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.inputSelector))),r=e.querySelector(".".concat(t.submitButtonSelector));n.forEach((function(n){return s(e,n,t)})),d(r,t)}(t,W),se(t))}(e.target)}))})),C.addEventListener("opened",(function(){oe(q,_.name),oe(g,_.about)})),T.addEventListener("opened",(function(){return oe(U,_.avatar)})),M.addEventListener("opened",(function(){return l(D,W)})),M.addEventListener("closed",(function(e){return pe(e.target,R)})),N.addEventListener("closed",(function(e){return pe(e.target,Q)})),E.addEventListener("submit",(function(e){return le(e,ue,q.value,g.value)})),B.addEventListener("submit",(function(e){return le(e,ie,U.value)})),L.addEventListener("submit",(function(e){return le(e,ae,j.value,A.value)}))})();
//# sourceMappingURL=main.js.map